(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.Raysync=e()}})(function(){var e,t,r;return function(){function S(n,i,a){function c(r,e){if(!i[r]){if(!n[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(l)return l(r,!0);var s=new Error("Cannot find module '"+r+"'");throw s.code="MODULE_NOT_FOUND",s}var o=i[r]={exports:{}};n[r][0].call(o.exports,function(e){var t=n[r][1][e];return c(t||e)},o,o.exports,S,n,i,a)}return i[r].exports}for(var l="function"==typeof require&&require,e=0;e<a.length;e++)c(a[e]);return c}return S}()({1:[function(e,t,r){var c=e("./utils");var l={UNKNOW:"UNKNOW",PING:"PING",HEART_BEAT:"HEART_BEAT",SERVERMODE:"servermode",CHECK:"check",LOGIN:"login",LOGOUT:"logout",SERVERS:"servers",GET_FTPMODE:"GET_FTPMODE",UPLOAD:"upload",DOWNLOAD:"download",DOWNLOADTO:"downloadto",LS:"list",MV:"mv",RM:"remove",RN:"rename",MKDIR:"create_folder",GET_TRANS_COUNT:"get_trans_count",OPEN_TRANS_LIST:"open_trans_list",START_UPDATE:"start_update",CREATEURL:"CREATEURL",SETURLCONF:"SETURLCONF",GETURLINFO:"GETURLINFO",CHECKURL:"CHECKURL",CHECKPASSWD:"CHECKPASSWD"};var S={UNKNOW:"UNKNOW",PING:"PING",HEART_BEAT:"HEART_BEAT",SERVERMODE:"servermode",CHECK:"check_response",LOGIN:"login_response",LOGOUT:"logout_response",SERVERS:"servers_response",GET_FTPMODE:"GET_FTPMODE",UPLOAD:"upload_response",DOWNLOAD:"download_response",DOWNLOADTO:"downloadto_response",LS:"list_response",MV:"mv",RM:"remove_response",RN:"rename_response",MKDIR:"create_folder_response",GET_TRANS_COUNT:"get_trans_count_response",TASK_COUNT:"task_count",START_UPDATE:"start_update_response",UPDATE_CLIENT:"download_update_file_response",DISCONNECT:"disconnect",CREATEURL:"createurl",SETURLCONF:"seturlconf",GETURLINFO:"geturkinfo",CHECKURL:"chechurl",CHECKPASSWD:"checkpasswd"};var i={ProtoVersion:1};var u={EMPTY:"EMPTY",WEBSRV:"WEBSRV",WEBUI:"WEBUI",WEBADMIN:"WEBADMIN",PROXYC:"PROXYC",PROXYS:"PROXYS",FTP_CLIENT:"FTP_CLIENT",FTP_SERVER:"FTP_SERVER",TYPHOON_CLIENT:"TYPHOON_CLIENT",TYPHOON_SERVER:"TYPHOON_SERVER"};var E={OK:0,WS_UNKNOW:1e3,WS_DBUNKNOW:1001,WS_ACCOUNTINVALID:1002,WS_ACCOUNTREQUIRED:1003,WS_ACCOUNTDUPLICATE:1004,WS_PASSWORDINVALID:1005,WS_PASSWORDREQUIRED:1006,WS_SERVERINVALID:1007,WS_ASSIGNINVALID:1008,WS_TOKENINVALID:1009,WS_IDINVALID:1010,WS_PBMARSHALANY:1011,WS_PBMARSHAL:1012,WS_PBUNMARSHAL:1013,WS_EMAILDUPLICATE:1014,WS_SERVERDEVICEREQUIRED:1015,WS_SERVERDEVICEDUPLICATE:1016,WS_ASSIGNDUPLICATE:1017,WS_ACCOUNTNOTALLOWED:1018,WS_ILLEGALOPERATION:1019,WS_INCORRECTACCOUNTFORMAT:1021,WS_INCORRECTEMAILFORMAT:1022,WS_INCORRECTPASSWORDFORMAT:1023,WS_INCORRECTNAMEFORMAT:1024,WS_INCORRECTPHONEFORMAT:1025,WS_INCORRECTHOSTFORMAT:1026,WS_INVALIDPORT:1027,WS_INVALIDTCPPORT:1028,WS_INVALIDUDPPORT:1029,WS_INVALIDBANDWIDTH:1030,WS_SITEACCESSDENIED:1031,WS_ONLYONEADMIN:1032,WS_DIRNOTEXIST:1033,WS_FILENOTEXIST:1034,WS_CMDFAILD:1035,WS_INVALIDPACKAGESIZE:1036,WS_DOESNOTEXIST:1037,WS_INCORRECTLICENSEFORMAT:1038,WS_CREATEUSERERROR:1039,WS_NOTFOUNDNETCARD:1040,WS_URLBROKEN:1041,WS_NOPERMISSION:1042,WS_PATHNOTEXIST:1043,WS_NOREADPERMISSION:1044,WS_NOWRITEPERMISSION:1045,WS_ILLEGAL:1046,WS_InvalidServerEmailAccount:1047,WS_InvalidServerEmailPassword:1048,WS_InvalidSmtpHostOrPort:1049,FC_UNKNOW:2e3,FC_FTPLOGIN:2001,FC_FTPLIST:2002,FC_FTPSERVERCLOSED:2003,FC_FTPSERVERNORUN:2004,FC_FTPSERVERDISC:2005,FC_OTHERUSERLOGIN:2006,FC_DIRNOTEXIST:2007,FC_FTPLOGING:2008,FC_CONNECTFAILD:2009,FC_MKDNOPERMISSION:2010,FC_CWDNOPERMISSION:2011,FC_RECONNECT:2012,FC_FTPCLIENTDISC:2013,FC_PARAMERR:2014,FC_AUTHFAILED:2015,FC_UPLOADRECURSIVING:2016,ERROR_PROXY_TIMEOUT:3e4,ERROR_CLIENT_CLOSED:30001,ERROR_CLIENT_TIMEOUT:30002,ERROR_MANAGER_ERROR:30003,ERROR_NOT_LOGIN_INFO:30004,ERROR_FAILED_TO_START_PROGRM:30005};var s={FILE:0,DIRECTORY:1,SYMLINK_FILE:2,SYMLINK_DIRECTORY:3,SYMLINK_UNKNOWN:4,IS_DIR:true};var o={FILES:0,DIRECTORIES:1};var f=function(){function e(){var r=this;this.promise=new Promise(function(e,t){r.resolve=e;r.reject=t})}return e}();function T(){this.handlers={}}T.prototype={varructor:EventTarget,on:function(e,t){if(typeof this.handlers[e]=="undefined"){this.handlers[e]=[]}this.handlers[e].push(t)},emit:function(e){if(!e.target){e.target=this}if(this.handlers[e.type]instanceof Array){var t=this.handlers[e.type];for(var r=0;r<t.length;r++){t[r](e.data)}}}};function n(n){var a=this;this.ports=[9527,19527,29527];this.failedPorts=[];this.lang="zh-CN";var e,t,r;this.obserable=new T;this.ifWebsocket=function(){if(typeof WebSocket=="undefined"){return false}else{return true}};this.login=function(e,t){var r=new f;var s={id:parseInt(String((new Date).getTime()/1e3),0),version:1,device:"",module:"WEBUI",action:"login",account:e,password:t};var o=JSON.stringify(s);c.http.post(n.webServer,o).then(function(e){var t=JSON.parse(e.data);if(t.result===0){a.client_version=t.client_version;a.protocol_version=t.protocol_version;r.resolve({type:"login",result:t.result,data:{userId:t.userId,account:t.account,protocol_version:t.protocol_version,client_version:t.client_version,isActived:t.actived},message:"success"})}else{r.reject({result:1,data:{},message:"failed"})}});return r.promise};this.createWebSocket=function(t,r,e){a.lang=e||"zh-CN";var s=[];a.ports.forEach(function(e){s.push(a.registerSocket("wss://localhost.raysync.io:"+e,t,r))});Promise.race(s).then(function(){}).catch(function(){setTimeout(a.createWebSocket(),300);a.obserable.emit({type:"webSocket",data:{type:"webSocket",result:"",message:"webSocket error:failed connect to raysync client",body:""}})})};this.registerSocket=function(t,o,n){var r=new f;if(!a.ifWebsocket()){return}var i=new WebSocket(t);i.onopen=function(){r.resolve(t.slice(t.indexOf("io:")+3,t.length));if(i.readyState===1){var e=JSON.stringify({action:l.CHECK,sign:"yunyu",protocol_version:a.protocol_version,client_version:a.client_version});i.send(e);a.checkTimeOut=setTimeout(function(){a.failedPorts.push(t.slice(t.indexOf("io:")+3,t.length));a.failedPorts=Array.from(new Set(a.failedPorts));if(a.failedPorts.length===a.ports.length){a.createWebSocket();a.obserable.emit({type:"webSocket",data:{type:"webSocket",result:1,message:"webSocket error:failed connect to raysync client",body:""}});console.log("webSocket error:failed connect to raysync client")}},3e3)}};i.onerror=function(){a.failedPorts.push(t.slice(t.indexOf("io:")+3,t.length));a.failedPorts=Array.from(new Set(this.failedPorts));if(a.failedPorts.length===a.ports.length){r.reject("close")}};i.onmessage=function(e){c.readBolbData(e).then(function(e){var t=JSON.parse(e);if(t.action.toLowerCase()===S.LOGIN){if(t.result!==0){a.obserable.emit({type:"loginRaysync",data:{type:"loginRaysync",result:t.result,message:"loginRaysync error",body:""}});console.log("login Raysync error")}else{a.obserable.emit({type:"loginRaysync",data:{type:"loginRaysync",result:t.result,message:"loginRaysync success",body:""}})}}else if(t.action.toLowerCase()===S.CHECK){if(t.sign.toLowerCase()==="raysync"){a.websocket=i;a.websocket.onclose=function(){a.websocket=null;a.createWebSocket()};a.obserable.emit({type:"webSocket",data:{type:"webSocket",result:0,message:"seccess:connected to raysync client",body:""}});a.obserable.emit({type:"CHECK",data:{type:"CHECK",result:t.result,message:"CHECK success",body:""}});clearTimeout(a.checkTimeOut);a.getServers(o,n)}else{}}else if(t.action.toLowerCase()===S.LS){var r=[],s="";if(t.result===E.OK){r=t.list||[];s=t.path;a.obserable.emit({type:"LS",data:{result:t.result,type:"LS",LS:r,Dir:s,message:"get file list success"}})}else{a.obserable.emit({type:"LS",data:{result:t.result,type:"LS",LS:r,Dir:s,message:"get file list Failed"}})}}else if(t.action.toLowerCase()===S.TASK_COUNT){a.obserable.emit({type:"TASK_COUNT",data:{result:t.result,type:"TASK_COUNT",count:t.count,message:"TASK_COUNT"}})}else if(t.action.toLowerCase()===S.UPDATE_CLIENT){a.obserable.emit({type:"UPDATE_CLIENT",data:{result:t.result,type:"UPDATE_CLIENT",count:t.version,message:"UPDATE_CLIENT"}})}else if(t.action.toLowerCase()===S.START_UPDATE){if(t.result!==0){a.obserable.emit({type:"START_UPDATE",data:{result:t.result,type:"START_UPDATE",message:"START_UPDATE Failed"}})}}else if(t.action.toLowerCase()===S.DISCONNECT){a.obserable.emit({type:"DISCONNECT",data:{result:t.result,type:"DISCONNECT",message:"DISCONNECT TO RAYSYNC SERVER"}})}else if(t.action.toLowerCase()===S.MKDIR){a.obserable.emit({type:"MKDIR",data:{result:t.result,type:"MKDIR",message:"MKDIR RESULT"}})}else if(t.action.toLowerCase()===S.GET_TRANS_COUNT){a.obserable.emit({type:"GET_TRANS_COUNT",data:{result:t.result,count:t.count,type:"GET_TRANS_COUNT",message:"GET_TRANS_COUNT"}})}else if(t.action.toLowerCase()===S.RN){a.obserable.emit({type:"rename",data:{result:t.result,type:"rename",message:"rename"}})}else if(t.action.toLowerCase()===S.RM){if(t.result===E.WS_NOPERMISSION){a.obserable.emit({type:"remove",data:{result:t.result,type:"remove",message:"NOPERMISSION"}})}}})};return r.promise};this.getServers=function(s,o){var e=JSON.stringify({id:parseInt(String((new Date).getTime()/1e3),0),version:i.ProtoVersion,device:"",module:u.WEBUI,action:l.SERVERS,account:s,password:o});c.http.post(n.webServer,e).then(function(e){var t=JSON.parse(e.data);if(t.result===E.OK){var r=JSON.parse(t.servers);a.loginRequest(s,o,r)}else{a.obserable.emit({type:"getserverinfo",data:{result:t.result,type:"getserverinfo",message:"get server info failed"}});console.log("get raysync server info failed")}})};this.loginRequest=function(e,t,r){var s=JSON.stringify({action:l.LOGIN,server_ip:r.host||window.location.hostname,server_port:r.port,proxy_ip:r.proxyHost||window.location.hostname,proxy_port:r.proxyPort,user_name:e,pass_word:t,language:this.lang||"zh-CN"});this.addWebSocket(s).then(function(){}).catch(function(){})};this.addWebSocket=function(e){var t=new f;if(!this.websocket){return t.promise}if(this.websocket.readyState===1){this.websocket.send(e);t.resolve("websocket do sent data")}else{this.createWebSocket()}return t.promise};this.getFileList=function(e){var t=JSON.stringify({action:l.LS,path:e});this.addWebSocket(t).catch(function(){})};this.upload=function(e,t){var r=JSON.stringify({action:l.UPLOAD,type:e,path:t});this.addWebSocket(r).catch(function(){})};this.download=function(e){var t=JSON.stringify({action:l.DOWNLOAD,src:e});this.addWebSocket(t).catch(function(){})};this.RM=function(e){var t=JSON.stringify({action:l.RM,path:e});this.addWebSocket(t).catch(function(){})};this.logOut=function(){this.normalClose=true;var e=JSON.stringify({action:l.LOGOUT});this.addWebSocket(e)};this.MKdirRequest=function(e,t){var r=JSON.stringify({action:l.MKDIR,name:e,remote_path:t});return this.addWebSocket(r)};this.rename=function(e,t){var r=JSON.stringify({action:l.RN,old_name:e,new_name:t});this.addWebSocket(r)};this.getTransCount=function(){var e=JSON.stringify({action:l.GET_TRANS_COUNT});this.addWebSocket(e)};this.showTransferList=function(e,t){var r=JSON.stringify({action:l.OPEN_TRANS_LIST,x:0,y:0});this.addWebSocket(r)};this.startUpdate=function(){var e=JSON.stringify({action:l.START_UPDATE,version:"0.0.0.1"});this.addWebSocket(e)}}t.exports=n},{"./utils":2}],2:[function(e,t,r){t.exports={readBolbData:function(o){var e=new Promise(function(t){if(o.data instanceof Blob){var e=o.data;var r=e.slice(0,o.data.size);var s=new FileReader;s.readAsText(r);s.onload=function(e){if(e.target.readyState==FileReader.DONE){t(e.target.result)}}}});return e},parseResponse:function(t){var e=new Promise(function(e){e(JSON.parse(t))});return e},speedUnitConversion:function(e,t){if(e<=0||e==undefined){return"0 KB/s"}else if(e<1024*1024){return(e/1024).toFixed(t)+" KB/s"}else if(e>=1048576&&e<1073741824){return(e/1048576).toFixed(t)+" MB/s"}else if(e>=1073741824&&e<1099511627776){return(e/1073741824).toFixed(t)+" GB/s"}else if(e>=1099511627776){return(e/1099511627776).toFixed(t)+" TB/s"}},unitConversion:function(e,t){if(e<0||e==undefined){return"--"}else if(e<1024){return e+" B"}else if(e>=1024&&e<1048576){return(e/1024).toFixed(t)+" KB"}else if(e>=1048576&&e<1073741824){return(e/1048576).toFixed(t)+" MB"}else if(e>=1073741824&&e<1099511627776){return(e/1073741824).toFixed(t)+" GB"}else if(e>=1099511627776){return(e/1099511627776).toFixed(t)+" TB"}else{}},bitConversion:function(e,t,r){var s=0;if(e<=0||e==undefined){s=0}else if(r.toLowerCase()=="k"){s=(e/1024).toFixed(t)}else if(r.toLowerCase()=="m"){s=(e/1048576).toFixed(t)}else if(r.toLowerCase()=="g"){s=(e/1073741824).toFixed(t)}else if(r.toLowerCase()=="t"){s=(e/1099511627776).toFixed(t)}else{}return parseFloat(s)},timeunitConversion:function(e){if(e<=0||e==undefined){return"00:00:00"}else if(e<60){t=e>9?e:"0"+e;return"00:00:"+t}else if(e<3600){var t=e%60;t=t>9?t:"0"+t;var r=parseInt(e/60%60);r=r>9?r:"0"+r;return"00:"+r+":"+t}else{var t=e%60;t=t>9?t:"0"+t;var r=parseInt(e/60%60);r=r>9?r:"0"+r;var s=parseInt(e/3600);s=s>9?s:"0"+s;return s+":"+r+":"+t}},dateFormat:function(e){Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};if(/(y+)/.test(e))e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));for(var r in t)if(new RegExp("("+r+")").test(e))e=e.replace(RegExp.$1,RegExp.$1.length==1?t[r]:("00"+t[r]).substr((""+t[r]).length));return e};return new Date(e).Format("yyyy-MM-dd HH:mm:ss")},http:{post:function(t,o){var e=new Promise(function(r,e){var s;if(window.ActiveXObject){try{s=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{s=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){s=false}}}else if(window.XMLHttpRequest){s=new XMLHttpRequest}s.open("POST",t,true);s.send(o);s.onreadystatechange=function(){var e={};if(s.readyState==4){if(s.status==200){var t=s.responseText;e.status=1;e.data=t;r(e)}}}});return e},get:function(t,o){var e=new Promise(function(r,e){var s;if(window.ActiveXObject){try{s=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{s=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){s=false}}}else if(window.XMLHttpRequest){s=new XMLHttpRequest}s.open("GET",t,true);s.send(o);s.onreadystatechange=function(){var e={};if(s.readyState==4){if(s.status==200){var t=s.responseText;e.status=1;e.data=t;r(e)}}}});return e}}}},{}]},{},[1])(1)});