(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.Raysync=e()}})(function(){var e,t,E;return function(){function R(o,n,i){function S(E,e){if(!n[E]){if(!o[E]){var t="function"==typeof require&&require;if(!e&&t)return t(E,!0);if(a)return a(E,!0);var r=new Error("Cannot find module '"+E+"'");throw r.code="MODULE_NOT_FOUND",r}var s=n[E]={exports:{}};o[E][0].call(s.exports,function(e){var t=o[E][1][e];return S(t||e)},s,s.exports,R,o,n,i)}return n[E].exports}for(var a="function"==typeof require&&require,e=0;e<i.length;e++)S(i[e]);return S}return R}()({1:[function(e,t,E){var S=e("./utils");var a={UNKNOW:"UNKNOW",PING:"PING",HEART_BEAT:"HEART_BEAT",SERVERMODE:"servermode",CHECK:"check",LOGIN:"login",LOGOUT:"logout",SERVERS:"servers",GET_FTPMODE:"GET_FTPMODE",UPLOAD:"upload",DOWNLOAD:"download",DOWNLOADTO:"downloadto",LS:"list",MV:"mv",RM:"remove",RN:"rename",MKDIR:"create_folder",GET_TRANS_COUNT:"get_trans_count",OPEN_TRANS_LIST:"open_trans_list",START_UPDATE:"start_update",START:"start",RESTART:"restart",SHUTDOWN:"shutdown",SESSIONS:"sessions",SELECT_USER:"SELECT_USER",SELECT_USERS:"SELECT_USERS",CREATE_USER:"CREATE_USER",CREATE_USERS:"CREATE_USERS",DELETE_USER:"DELETE_USER",DELETE_USERS:"DELETE_USERS",UPDATE_USER:"UPDATE_USER",UPDATE_USERS:"UPDATE_USERS",USERS_COUNT:"USERS_COUNT",UPDATE_USERPWD:"UPDATE_USERPWD",SELECT_ADMIN:"UPDATE_USERPWD",SELECT_ADMINS:"SELECT_ADMINS",CREATE_ADMIN:"CREATE_ADMIN",CREATE_ADMINS:"CREATE_ADMINS",DELETE_ADMINS:"DELETE_ADMINS",UPDATE_ADMIN:"UPDATE_ADMIN",UPDATE_ADMINS:"UPDATE_ADMINS",ADMINS_COUNT:"ADMINS_COUNT",UPDATE_ADMINPWD:"UPDATE_ADMINPWD",SELECT_SERVER:"SELECT_SERVER",SELECT_SERVERS:"SELECT_SERVERS",CREATE_SERVER:"CREATE_SERVER",CREATE_SERVERS:"CREATE_SERVERS",DELETE_SERVER:"DELETE_SERVER",DELETE_SERVERS:"DELETE_SERVERS",UPDATE_SERVER:"UPDATE_SERVER",UPDATE_SERVERS:"UPDATE_SERVERS",SERVERS_COUNT:"SERVERS_COUNT",REMAIN_SERVERS:"REMAIN_SERVERS",PERFORMANCE:"performance",LICENSE:"license",CREATEURL:"CREATEURL",SETURLCONF:"SETURLCONF",GETURLINFO:"GETURLINFO",CHECKURL:"CHECKURL",CHECKPASSWD:"CHECKPASSWD"};var R={UNKNOW:"UNKNOW",PING:"PING",HEART_BEAT:"HEART_BEAT",SERVERMODE:"servermode",CHECK:"check_response",LOGIN:"login_response",LOGOUT:"logout_response",SERVERS:"servers_response",GET_FTPMODE:"GET_FTPMODE",UPLOAD:"upload_response",DOWNLOAD:"download_response",DOWNLOADTO:"downloadto_response",LS:"list_response",MV:"mv",RM:"remove_response",RN:"rename_response",MKDIR:"create_folder_response",GET_TRANS_COUNT:"get_trans_count_response",TASK_COUNT:"task_count",START_UPDATE:"start_update_response",UPDATE_CLIENT:"download_update_file_response",DISCONNECT:"disconnect",START:"start",RESTART:"restart",SHUTDOWN:"shutdown",SESSIONS:"sessions",SELECT_USER:"SELECT_USER",SELECT_USERS:"SELECT_USERS",CREATE_USER:"CREATE_USER",CREATE_USERS:"CREATE_USERS",DELETE_USER:"DELETE_USER",DELETE_USERS:"DELETE_USERS",UPDATE_USER:"UPDATE_USER",UPDATE_USERS:"UPDATE_USERS",USERS_COUNT:"USERS_COUNT",UPDATE_USERPWD:"UPDATE_USERPWD",SELECT_ADMIN:"UPDATE_USERPWD",SELECT_ADMINS:"SELECT_ADMINS",CREATE_ADMIN:"CREATE_ADMIN",CREATE_ADMINS:"CREATE_ADMINS",DELETE_ADMINS:"DELETE_ADMINS",UPDATE_ADMIN:"UPDATE_ADMIN",UPDATE_ADMINS:"UPDATE_ADMINS",ADMINS_COUNT:"ADMINS_COUNT",UPDATE_ADMINPWD:"UPDATE_ADMINPWD",SELECT_SERVER:"SELECT_SERVER",SELECT_SERVERS:"SELECT_SERVERS",CREATE_SERVER:"CREATE_SERVER",CREATE_SERVERS:"CREATE_SERVERS",DELETE_SERVER:"DELETE_SERVER",DELETE_SERVERS:"DELETE_SERVERS",UPDATE_SERVER:"UPDATE_SERVER",UPDATE_SERVERS:"UPDATE_SERVERS",SERVERS_COUNT:"SERVERS_COUNT",REMAIN_SERVERS:"REMAIN_SERVERS",PERFORMANCE:"performance",LICENSE:"license",CREATEURL:"createurl",SETURLCONF:"seturlconf",GETURLINFO:"geturkinfo",CHECKURL:"chechurl",CHECKPASSWD:"checkpasswd"};var n={ProtoVersion:1};var T={EMPTY:"EMPTY",WEBSRV:"WEBSRV",WEBUI:"WEBUI",WEBADMIN:"WEBADMIN",PROXYC:"PROXYC",PROXYS:"PROXYS",FTP_CLIENT:"FTP_CLIENT",FTP_SERVER:"FTP_SERVER",TYPHOON_CLIENT:"TYPHOON_CLIENT",TYPHOON_SERVER:"TYPHOON_SERVER"};var _={OK:0,WS_UNKNOW:1e3,WS_DBUNKNOW:1001,WS_ACCOUNTINVALID:1002,WS_ACCOUNTREQUIRED:1003,WS_ACCOUNTDUPLICATE:1004,WS_PASSWORDINVALID:1005,WS_PASSWORDREQUIRED:1006,WS_SERVERINVALID:1007,WS_ASSIGNINVALID:1008,WS_TOKENINVALID:1009,WS_IDINVALID:1010,WS_PBMARSHALANY:1011,WS_PBMARSHAL:1012,WS_PBUNMARSHAL:1013,WS_EMAILDUPLICATE:1014,WS_SERVERDEVICEREQUIRED:1015,WS_SERVERDEVICEDUPLICATE:1016,WS_ASSIGNDUPLICATE:1017,WS_ACCOUNTNOTALLOWED:1018,WS_ILLEGALOPERATION:1019,WS_INCORRECTACCOUNTFORMAT:1021,WS_INCORRECTEMAILFORMAT:1022,WS_INCORRECTPASSWORDFORMAT:1023,WS_INCORRECTNAMEFORMAT:1024,WS_INCORRECTPHONEFORMAT:1025,WS_INCORRECTHOSTFORMAT:1026,WS_INVALIDPORT:1027,WS_INVALIDTCPPORT:1028,WS_INVALIDUDPPORT:1029,WS_INVALIDBANDWIDTH:1030,WS_SITEACCESSDENIED:1031,WS_ONLYONEADMIN:1032,WS_DIRNOTEXIST:1033,WS_FILENOTEXIST:1034,WS_CMDFAILD:1035,WS_INVALIDPACKAGESIZE:1036,WS_DOESNOTEXIST:1037,WS_INCORRECTLICENSEFORMAT:1038,WS_CREATEUSERERROR:1039,WS_NOTFOUNDNETCARD:1040,WS_URLBROKEN:1041,WS_NOPERMISSION:1042,WS_PATHNOTEXIST:1043,WS_NOREADPERMISSION:1044,WS_NOWRITEPERMISSION:1045,WS_ILLEGAL:1046,WS_InvalidServerEmailAccount:1047,WS_InvalidServerEmailPassword:1048,WS_InvalidSmtpHostOrPort:1049,FC_UNKNOW:2e3,FC_FTPLOGIN:2001,FC_FTPLIST:2002,FC_FTPSERVERCLOSED:2003,FC_FTPSERVERNORUN:2004,FC_FTPSERVERDISC:2005,FC_OTHERUSERLOGIN:2006,FC_DIRNOTEXIST:2007,FC_FTPLOGING:2008,FC_CONNECTFAILD:2009,FC_MKDNOPERMISSION:2010,FC_CWDNOPERMISSION:2011,FC_RECONNECT:2012,FC_FTPCLIENTDISC:2013,FC_PARAMERR:2014,FC_AUTHFAILED:2015,FC_UPLOADRECURSIVING:2016,ERROR_PROXY_TIMEOUT:3e4,ERROR_CLIENT_CLOSED:30001,ERROR_CLIENT_TIMEOUT:30002,ERROR_MANAGER_ERROR:30003,ERROR_NOT_LOGIN_INFO:30004,ERROR_FAILED_TO_START_PROGRM:30005};var r={FILE:0,DIRECTORY:1,SYMLINK_FILE:2,SYMLINK_DIRECTORY:3,SYMLINK_UNKNOWN:4,IS_DIR:true};var s={FILES:0,DIRECTORIES:1};console.log(a);var c=function(){function e(){var E=this;this.promise=new Promise(function(e,t){E.resolve=e;E.reject=t})}return e}();function l(){this.handlers={}}l.prototype={varructor:EventTarget,on:function(e,t){if(typeof this.handlers[e]=="undefined"){this.handlers[e]=[]}this.handlers[e].push(t)},emit:function(e){if(!e.target){e.target=this}if(this.handlers[e.type]instanceof Array){var t=this.handlers[e.type];for(var E=0;E<t.length;E++){t[E](e.data)}}}};function o(o){var i=this;this.ports=[9527,19527,29527];this.failedPorts=[];var e,t,E;this.obserable=new l;this.ifWebsocket=function(){if(typeof WebSocket=="undefined"){return false}else{return true}};this.login=function(e,t){var E=new c;var r={id:parseInt(String((new Date).getTime()/1e3),0),version:1,device:"",module:"WEBUI",action:"login",account:e,password:t};var s=JSON.stringify(r);S.http.post(o.webServer,s).then(function(e){var t=JSON.parse(e.data);if(t.result===0){i.client_version=t.client_version;i.protocol_version=t.protocol_version;E.resolve({type:"login",result:t.result,data:{userId:t.userId,account:t.account,protocol_version:t.protocol_version,client_version:t.client_version,isActived:t.actived},message:"success"})}else{E.reject({result:1,data:{},message:"failed"})}});return E.promise};this.createWebSocket=function(t,E){var r=[];i.ports.forEach(function(e){r.push(i.registerSocket("wss://localhost.raysync.io:"+e,t,E))});Promise.race(r).then(function(){}).catch(function(){setTimeout(i.createWebSocket(),300);i.obserable.emit({type:"webSocket",data:{type:"webSocket",result:"",message:"webSocket error:failed connect to raysync client",body:""}})})};this.registerSocket=function(t,s,o){var E=new c;if(!i.ifWebsocket()){return}var n=new WebSocket(t);n.onopen=function(){E.resolve(t.slice(t.indexOf("io:")+3,t.length));if(n.readyState===1){var e=JSON.stringify({action:a.CHECK,sign:"yunyu",protocol_version:i.protocol_version,client_version:i.client_version});n.send(e);i.checkTimeOut=setTimeout(function(){i.failedPorts.push(t.slice(t.indexOf("io:")+3,t.length));i.failedPorts=Array.from(new Set(i.failedPorts));if(i.failedPorts.length===i.ports.length){i.createWebSocket();i.obserable.emit({type:"webSocket",data:{type:"webSocket",result:"",message:"webSocket error:failed connect to raysync client",body:""}});console.log("webSocket error:failed connect to raysync client")}},3e3)}};n.onerror=function(){i.failedPorts.push(t.slice(t.indexOf("io:")+3,t.length));i.failedPorts=Array.from(new Set(this.failedPorts));if(i.failedPorts.length===i.ports.length){E.reject("close")}};n.onmessage=function(e){S.readBolbData(e).then(function(e){var t=JSON.parse(e);if(t.action.toLowerCase()===R.LOGIN){if(t.result!==0){i.obserable.emit({type:"loginRaysync",data:{type:"loginRaysync",result:t.result,message:"loginRaysync error",body:""}});console.log("login Raysync error")}else{i.obserable.emit({type:"loginRaysync",data:{type:"loginRaysync",result:t.result,message:"loginRaysync success",body:""}})}}else if(t.action.toLowerCase()===R.CHECK){if(t.sign.toLowerCase()==="raysync"){i.websocket=n;i.websocket.onclose=function(){i.websocket=null;i.createWebSocket()};i.obserable.emit({type:"CHECK",data:{type:"CHECK",result:t.result,message:"CHECK success",body:""}});clearTimeout(i.checkTimeOut);i.getServers(s,o)}else{}}else if(t.action.toLowerCase()===R.LS){var E=[],r="";if(t.result===_.OK){E=t.list||[];r=t.path;i.obserable.emit({type:"LS",data:{result:t.result,type:"LS",LS:E,Dir:r,message:"get file list success"}})}else{i.obserable.emit({type:"LS",data:{result:t.result,type:"LS",LS:E,Dir:r,message:"get file list Failed"}})}}else if(t.action.toLowerCase()===R.TASK_COUNT){i.obserable.emit({type:"TASK_COUNT",data:{result:t.result,type:"TASK_COUNT",count:t.count,message:"TASK_COUNT"}})}else if(t.action.toLowerCase()===R.UPDATE_CLIENT){i.obserable.emit({type:"UPDATE_CLIENT",data:{result:t.result,type:"UPDATE_CLIENT",count:t.version,message:"UPDATE_CLIENT"}})}else if(t.action.toLowerCase()===R.START_UPDATE){if(t.result!==0){i.obserable.emit({type:"START_UPDATE",data:{result:t.result,type:"START_UPDATE",message:"START_UPDATE Failed"}})}}else if(t.action.toLowerCase()===R.DISCONNECT){i.obserable.emit({type:"DISCONNECT",data:{result:t.result,type:"DISCONNECT",message:"DISCONNECT TO RAYSYNC SERVER"}})}else if(t.action.toLowerCase()===R.MKDIR){i.obserable.emit({type:"MKDIR",data:{result:t.result,type:"MKDIR",message:"MKDIR RESULT"}})}else if(t.action.toLowerCase()===R.GET_TRANS_COUNT){i.obserable.emit({type:"GET_TRANS_COUNT",data:{result:t.result,count:t.count,type:"GET_TRANS_COUNT",message:"GET_TRANS_COUNT"}})}else if(t.action.toLowerCase()===R.RN){i.obserable.emit({type:"rename",data:{result:t.result,type:"rename",message:"rename"}})}else if(t.action.toLowerCase()===R.RM){if(t.result===_.WS_NOPERMISSION){i.obserable.emit({type:"remove",data:{result:t.result,type:"remove",message:"NOPERMISSION"}})}}})};return E.promise};this.getServers=function(r,s){var e=JSON.stringify({id:parseInt(String((new Date).getTime()/1e3),0),version:n.ProtoVersion,device:"",module:T.WEBUI,action:a.SERVERS,account:r,password:s});S.http.post(o.webServer,e).then(function(e){var t=JSON.parse(e.data);if(t.result===_.OK){var E=JSON.parse(t.servers);i.loginRequest(r,s,E)}else{i.obserable.emit({type:"getserverinfo",data:{result:t.result,type:"getserverinfo",message:"get server info failed"}});console.log("get raysync server info failed")}})};this.loginRequest=function(e,t,E){var r=JSON.stringify({action:a.LOGIN,server_ip:E.host||window.location.hostname,server_port:E.port,proxy_ip:E.proxyHost||window.location.hostname,proxy_port:E.proxyPort,user_name:e,pass_word:t,language:""});this.addWebSocket(r).then(function(){}).catch(function(){})};this.addWebSocket=function(e){var t=new c;if(!this.websocket){return t.promise}if(this.websocket.readyState===1){this.websocket.send(e);t.resolve("websocket do sent data")}else{this.createWebSocket()}return t.promise};this.getFileList=function(e){var t=JSON.stringify({action:a.LS,path:e});this.addWebSocket(t).catch(function(){})};this.upload=function(e,t){var E=JSON.stringify({action:a.UPLOAD,type:e,path:t});this.addWebSocket(E).catch(function(){})};this.download=function(e){var t=JSON.stringify({action:a.DOWNLOAD,src:e});this.addWebSocket(t).catch(function(){})};this.RM=function(e){var t=JSON.stringify({action:a.RM,path:e});this.addWebSocket(t).catch(function(){})};this.logOut=function(){this.normalClose=true;var e=JSON.stringify({action:a.LOGOUT});this.addWebSocket(e)};this.MKdirRequest=function(e,t){var E=JSON.stringify({action:a.MKDIR,name:e,remote_path:t});return this.addWebSocket(E)};this.rename=function(e,t){var E=JSON.stringify({action:a.RN,old_name:e,new_name:t});this.addWebSocket(E)};this.getTransCount=function(){var e=JSON.stringify({action:a.GET_TRANS_COUNT});this.addWebSocket(e)};this.showTransferList=function(e,t){var E=JSON.stringify({action:a.OPEN_TRANS_LIST,x:0,y:0});this.addWebSocket(E)};this.startUpdate=function(){var e=JSON.stringify({action:a.START_UPDATE,version:"0.0.0.1"});this.addWebSocket(e)}}t.exports=o},{"./utils":2}],2:[function(e,t,E){t.exports={readBolbData:function(s){var e=new Promise(function(t){if(s.data instanceof Blob){var e=s.data;var E=e.slice(0,s.data.size);var r=new FileReader;r.readAsText(E);r.onload=function(e){if(e.target.readyState==FileReader.DONE){t(e.target.result)}}}});return e},parseResponse:function(t){var e=new Promise(function(e){e(JSON.parse(t))});return e},speedUnitConversion:function(e,t){if(e<=0||e==undefined){return"0 KB/s"}else if(e<1024*1024){return(e/1024).toFixed(t)+" KB/s"}else if(e>=1048576&&e<1073741824){return(e/1048576).toFixed(t)+" MB/s"}else if(e>=1073741824&&e<1099511627776){return(e/1073741824).toFixed(t)+" GB/s"}else if(e>=1099511627776){return(e/1099511627776).toFixed(t)+" TB/s"}},unitConversion:function(e,t){if(e<0||e==undefined){return"--"}else if(e<1024){return e+" B"}else if(e>=1024&&e<1048576){return(e/1024).toFixed(t)+" KB"}else if(e>=1048576&&e<1073741824){return(e/1048576).toFixed(t)+" MB"}else if(e>=1073741824&&e<1099511627776){return(e/1073741824).toFixed(t)+" GB"}else if(e>=1099511627776){return(e/1099511627776).toFixed(t)+" TB"}else{}},bitConversion:function(e,t,E){var r=0;if(e<=0||e==undefined){r=0}else if(E.toLowerCase()=="k"){r=(e/1024).toFixed(t)}else if(E.toLowerCase()=="m"){r=(e/1048576).toFixed(t)}else if(E.toLowerCase()=="g"){r=(e/1073741824).toFixed(t)}else if(E.toLowerCase()=="t"){r=(e/1099511627776).toFixed(t)}else{}return parseFloat(r)},timeunitConversion:function(e){if(e<=0||e==undefined){return"00:00:00"}else if(e<60){t=e>9?e:"0"+e;return"00:00:"+t}else if(e<3600){var t=e%60;t=t>9?t:"0"+t;var E=parseInt(e/60%60);E=E>9?E:"0"+E;return"00:"+E+":"+t}else{var t=e%60;t=t>9?t:"0"+t;var E=parseInt(e/60%60);E=E>9?E:"0"+E;var r=parseInt(e/3600);r=r>9?r:"0"+r;return r+":"+E+":"+t}},dateFormat:function(e){Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};if(/(y+)/.test(e))e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));for(var E in t)if(new RegExp("("+E+")").test(e))e=e.replace(RegExp.$1,RegExp.$1.length==1?t[E]:("00"+t[E]).substr((""+t[E]).length));return e};return new Date(e).Format("yyyy-MM-dd HH:mm:ss")},http:{post:function(t,s){var e=new Promise(function(E,e){var r;if(window.ActiveXObject){try{r=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{r=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){r=false}}}else if(window.XMLHttpRequest){r=new XMLHttpRequest}r.open("POST",t,true);r.send(s);r.onreadystatechange=function(){var e={};if(r.readyState==4){if(r.status==200){var t=r.responseText;e.status=1;e.data=t;E(e)}}}});return e},get:function(t,s){var e=new Promise(function(E,e){var r;if(window.ActiveXObject){try{r=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{r=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){r=false}}}else if(window.XMLHttpRequest){r=new XMLHttpRequest}r.open("GET",t,true);r.send(s);r.onreadystatechange=function(){var e={};if(r.readyState==4){if(r.status==200){var t=r.responseText;e.status=1;e.data=t;E(e)}}}});return e}}}},{}]},{},[1])(1)});